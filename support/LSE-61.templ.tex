\documentclass[SE,toc,lsstdraft]{lsstdoc}

## This is a template file that can be used to generate LaTeX documents
## from within MagicDraw. It uses the standard lsstdoc LaTeX classes

## When importing updates in the VTL from the Word template unicode quotes
## (single and double) must be converted to simple quotes.

## After the document has been generated, it will be neccessary to run
## the fixup.py script to ensure that the embedded HTML and list directives
## are handled properly in the LaTeX.

% We use a command to make it easy to find where parameter names are defined
% in the tables
\newcommand{\paramname}[1]{#1}

#set($scopedPackage = $packageScope.get(0))

\setcounter{secnumdepth}{5}
\title{$scopedPackage.name}
\author{Gregory Dubois-Felsmann}
\date{\today}
\setDocRef{LSE-61}

% Change history defined here. Will be inserted into
% correct place with \maketitle
% OLDEST FIRST: VERSION, DATE, DESCRIPTION, OWNER NAME
\setDocChangeRecord{%
\addtohist{0.1}{2007}{Initial version}{G.~Dubois-Felsmann}
\addtohist{0.5}{2009 Feb}{Approved as a content-controlled document by the CCB.}{G.~Dubois-Felsmann}
\addtohist{1.0}{2011-06-28}{Captured DM Functional Requirements Specification as version 1 of new document LSE-61.}{G.~Dubois-Felsmann}
\addtohist{1.1}{2011-08-03}{Requirements numbering applied.  Original numbering preserved for a transition period.}{G.~Dubois-Felsmann}
\addtohist{2.0}{2013-10-08}{Extensive reorganization and partial rewrite; corresponds to CVS revision 1.44 in SysArch.}{D.~Shaw, M.~Juric, G.~Dubois-Felsmann}
\addtohist{2.0.1}{2013-10-08}{Corrections affecting DMS-REQ-0176, -0267, -0268, -0287, and the creation of -0317.  CVS revision 1.45.}{G.~Dubois-Felsmann}
\addtohist{2.0.2}{2013-10-08}{Incorrect statements removed from Discussion in DMS-REQ-0271 and DMS-REQ-0283, many typos corrected. CVS revision 1.46.}{G.~Dubois-Felsmann}
\addtohist{3.0}{2016-02-01}{Incorporation of LCR-188 (addition of DMS-REQ-0318 Data Management Unscheduled Downtime)}{G.~Dubois-Felsmann, and B.~Selvy}
}

% Environment for displaying the parameter tables in
% a consistent manner. No arguments as there are no
% captions or labels.
\newenvironment{parameters}[0]{%
\setlength\LTleft{0pt}
\setlength\LTright{\fill}
\begin{small}
\begin{longtable}[]{|p{0.5\textwidth}|l|p{0.6in}|p{1.74in}@{}|}

\hline \textbf{Description} & \textbf{Value} & \textbf{Unit} & \textbf{Name} \\ \hline
\endhead

\hline \multicolumn{4}{r}{\emph{Continued on next page}} \\
\endfoot

\hline\hline
\endlastfoot
}{%
\hline
\end{longtable}
\end{small}
}



\begin{document}
\maketitle

$scopedPackage.documentation

#foreach($child in $scopedPackage.getOwnedElement())
#if($report.containsStereotype($child,"Requirement") || $report.containsStereotype($child,"interfaceRequirement") || $child.getHumanType() == 'Package')
#recursiveReqs($child,1)
#end
#end
#macro( recursiveReqs $element $depth)
#if($element.getHumanType() == 'Package')
#properHeading($element.name,$depth)
$element.documentation
#elseif(($report.containsStereotype($element,"Requirement") || $report.containsStereotype($element,"interfaceRequirement")) && !$report.containsStereotype($element,"VerificationPlanningElement"))
#properHeading($element.name,$depth)
#if(!$report.getStereotypeProperty($element,"Requirement","Id").isEmpty())

\textbf{ID:} $report.getStereotypeProperty($element,"Requirement","Id").get(0)

#end
#if(!$report.getStereotypeProperty($element,"Requirement","Text").isEmpty())
$report.getStereotypeProperty($element,"Requirement","Text").get(0)

#end
$element.documentation
#end

#set($refines = $array.createArray())
#foreach($subRelation in $element.get_directedRelationshipOfTarget())
#if($report.containsStereotype($subRelation,"Refine"))
#set($filler = $refines.add($subRelation))
#end
#end
#if(!$refines.isEmpty())

## Note that forrow seems to be a MagicDraw extension that is designed
## specifically for Word tables. When syncing these VTL macros from the
## Word reference remember to replace forrow with foreach.

\begin{parameters}
#foreach($refine in $refines)
$refine.getSource().get(0).documentation
&
#set($length = $refine.getSource().get(0).name.length() + 3)
$refine.getSource().get(0).get_constraintOfConstrainedElement().get(0).getSpecification().getBody().get(0).substring($length)
&
$refine.getSource().get(0).unit.name
&
\paramname{$refine.getSource().get(0).name} \\\hline
#end
\end{parameters}

#end
#foreach($subElement in $element.getOwnedElement())
#if($report.containsStereotype($subElement,"Requirement") || $report.containsStereotype($subElement,"interfaceRequirement") || $subElement.getHumanType() == 'Package')
#set($depth = $depth + 1)
#recursiveReqs($subElement,$depth)
#set($depth = $depth - 1)
#end
#end
#end
#macro( properHeading $string $depth)
#if($depth == 1)
\section{$string}
#elseif($depth == 2)
\subsection{$string}
#elseif($depth == 3)
\subsubsection{$string}
#elseif($depth == 4)
\paragraph{$string}\hfill  % Force subsequent text onto new line
#elseif($depth == 5)
\subparagraph{$string}\hfill  % Force subsequent text onto new line
#elseif($depth == 6)
\textsc{$string}

#elseif($depth == 7)
\textbf{\textit{$string}}

#elseif($depth == 8)
\textit{$string}

#else
$string

#end
#end

\bibliography{lsst}

\end{document}
